---
/**
 * Reset Password Page
 *
 * Renders the form for setting a new password after following a reset link.
 * The user should have a valid session from the password reset email link.
 * The session is established in the confirm page before redirecting here.
 */

import AuthLayout from "../../layouts/AuthLayout.astro";
import { ResetPasswordForm } from "../../components/auth/ResetPasswordForm";
import { createSupabaseServerInstance } from "../../db/supabase.client";

// Create Supabase client
const supabase = createSupabaseServerInstance({
  cookies: Astro.cookies,
  headers: Astro.request.headers,
});

// Check if user has a valid session for password reset
const {
  data: { session },
} = await supabase.auth.getSession();

// If no session, redirect to forgot password page
// The user needs to request a new reset link
if (!session) {
  return Astro.redirect("/auth/forgot-password?error=session_expired");
}

export const prerender = false;
---

<AuthLayout title="Set New Password" description="Create a new password for your account">
  <ResetPasswordForm client:load />
  <div slot="footer">
    <p>Â© {new Date().getFullYear()} 10x Cards. All rights reserved.</p>
  </div>
</AuthLayout>
