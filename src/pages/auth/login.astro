---
/**
 * Login Page
 *
 * Renders the login form and handles redirect parameters
 */

import AuthLayout from "../../layouts/AuthLayout.astro";
import { LoginForm } from "../../components/auth/LoginForm";

// Get redirect URL from query parameters
const redirect = Astro.url.searchParams.get("redirect");

// Check if user is already authenticated using session in context.locals
// This is now handled by middleware, but we'll do an additional check here
if (Astro.locals.session) {
  return Astro.redirect(redirect || "/generate");
}

// Add environment variables for client-side components
const SUPABASE_URL = import.meta.env.SUPABASE_URL;
const SUPABASE_KEY = import.meta.env.SUPABASE_KEY;
---

<script is:inline define:vars={{ SUPABASE_URL, SUPABASE_KEY }}>
  // Set client-side environment variables
  window.ENV = {
    SUPABASE_URL,
    SUPABASE_KEY,
  };
  console.log("[Login Page] Environment variables set:", {
    hasUrl: !!window.ENV.SUPABASE_URL,
    hasKey: !!window.ENV.SUPABASE_KEY,
  });
</script>

<AuthLayout title="Log In">
  <LoginForm client:load redirectTo={redirect || undefined} />
  <div slot="footer">
    <p>Â© {new Date().getFullYear()} 10x Cards. All rights reserved.</p>
  </div>
</AuthLayout>
