---
/**
 * Generate View Page
 *
 * Allows users to generate flashcard proposals from source text using AI.
 * Users can review, accept, edit, or reject proposals before batch-saving them.
 */

import Layout from "../layouts/Layout.astro";
import { GenerateViewContainer } from "../components/generate/GenerateViewContainer";
import { NavigationBar } from "../components/layout/NavigationBar";

// Get user information from context.locals
// This is now handled by middleware, but we'll do an additional check
const { user } = Astro.locals;
const userEmail = user?.email || "";

// If user is not authenticated, redirect to login
// This is handled by middleware, but as an extra precaution:
if (!user) {
  return Astro.redirect("/auth/login?redirect=/generate");
}

// Add environment variables for client-side components
const SUPABASE_URL = import.meta.env.SUPABASE_URL;
const SUPABASE_KEY = import.meta.env.SUPABASE_KEY;
const envVars = { SUPABASE_URL, SUPABASE_KEY };
---

<!-- eslint-disable-next-line prettier/prettier -->
<script is:inline define:vars={envVars}>
  // prettier-ignore
  // Set client-side environment variables
  window.ENV = {
    SUPABASE_URL,
    SUPABASE_KEY,
  };
  console.log("[Generate Page] Environment variables set:", {
    hasUrl: !!window.ENV.SUPABASE_URL,
    hasKey: !!window.ENV.SUPABASE_KEY,
  });
</script>

<Layout title="Generate Flashcards - 10x Cards">
  <NavigationBar userEmail={userEmail} client:load />
  <GenerateViewContainer client:load />
</Layout>
